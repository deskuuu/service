<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_847697_serviceno.incidentWidget</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description>Create 2 widgets:&#13;
• First will be a list with [Incident] records with State "In Progress" (design the list so it is with small width, since it will be put next to the second one). The idea is when you click on any of the incidents to show the information on the second widget. The list should not contain more than 10 records in order to have a smaller height.&#13;
*BONUS: let the list be with as many records as found but set a height limit and make the widget scrollable.&#13;
*OPTIONAL: on hover of any of the incidents change the background color and the scale to 1.05 • Second will be a container, which will contain the fields Number, Caller, Category, Priority, Assignment group, Short description. When the first widget is clicked, this one will display the field values. Style the widget as you wish.</description>
        <name>incidentWidget</name>
        <script><![CDATA[var incidentWidget = Class.create();
incidentWidget.prototype = {

    /**
    * This function query incidents data by provided 'Number of quantity' based on the paramters received (count) and returns arr of queried Incidents with the properties:number,caller,category,priority,assignmentGroup ,shortDescription 
    *
    * @param {Int} 'count' the number for the quantity of queried incidents;
	
    * @returns {Arr} incidents with properties;
    */

    getIncidentsLimit: function(count) {
        var incident = new GlideRecord("incident");
        incident.addQuery("state", 1);
        incident.setLimit(count);
        incident.query();

        var items = [];

        while (incident.next()) {
            var item = {};

            item.number = incident.getDisplayValue('number');
            item.caller = incident.getDisplayValue('caller_id');
            item.category = incident.getDisplayValue('category');
            item.priority = incident.getDisplayValue('priority');
            item.assignmentGroup = incident.getDisplayValue('assignment_group');
            item.shortDescription = incident.getDisplayValue('short_description');

            items.push(item);
        }

        return items;
    },

    updateIncidentRecord: function(incidentNumber, incidentCaller, incidentCategory, incidentAssignmentGroup, incidentShortDescription) {
        var incident = new GlideRecord("incident");
        incident.addQuery('number', incidentNumber);
        incident.query();

        var caller = this.getCallerSysID(incidentCaller);

        if (incident.next()) {
            if (incident.getDisplayValue('caller_id') != incidentCaller) {
                incident.setValue('caller_id', caller);
            } else if (incident.getDisplayValue('category') != incidentCategory) {
                incident.setValue('category', incidentCategory);
            } else if (incident.getDisplayValue('assignment_group') != incidentAssignmentGroup) {
                incident.setValue('assignment_group', incidentAssignmentGroup);
            } else if (incident.getDisplayValue('short_description') != incidentShortDescription) {
                incident.short_description = incidentShortDescription;
            }

            incident.update();
        }

    },

    getCallerSysID: function(incidentCaller) {
        var user = new GlideRecord('sys_user');
        user.addQuery('name', incidentCaller);
        user.query();

        var userId;

        if (user.next()) {
            userId = user.getValue('sys_id');
        }

        return userId;
    },
	
	verifyCategory: function(incidentCategory){
		// too much GLideRecords?
	},

    type: 'incidentWidget'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-08-19 09:27:33</sys_created_on>
        <sys_id>7e28da1b2fd55510b2ab3f96f699b6b1</sys_id>
        <sys_mod_count>15</sys_mod_count>
        <sys_name>incidentWidget</sys_name>
        <sys_package display_value="ServiceNowTasks" source="x_847697_serviceno">b979020a2f9d1110b2ab3f96f699b655</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="ServiceNowTasks">b979020a2f9d1110b2ab3f96f699b655</sys_scope>
        <sys_update_name>sys_script_include_7e28da1b2fd55510b2ab3f96f699b6b1</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2022-10-12 08:19:09</sys_updated_on>
    </sys_script_include>
</record_update>
